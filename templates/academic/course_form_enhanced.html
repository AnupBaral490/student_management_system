{% extends 'base.html' %}
{% load static %}

{% block title %}{{ title }} - SMS{% endblock %}

{% block extra_css %}
<style>
    .section-card {
        border: 1px solid #dee2e6;
        border-radius: 0.375rem;
        margin-bottom: 1.5rem;
    }
    .section-header {
        background-color: #f8f9fa;
        padding: 0.75rem 1rem;
        border-bottom: 1px solid #dee2e6;
        font-weight: 600;
    }
    .section-body {
        padding: 1rem;
    }
    .dynamic-form-row {
        border: 1px solid #e9ecef;
        border-radius: 0.25rem;
        padding: 1rem;
        margin-bottom: 1rem;
        background-color: #f8f9fa;
    }
    .remove-btn {
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
    }
    .add-btn {
        margin-top: 1rem;
    }
    .student-enrollment-section {
        display: none;
    }
</style>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2><i class="fas fa-graduation-cap"></i> {{ title }}</h2>
            <a href="{% url 'academic:course_list' %}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Back
            </a>
        </div>
    </div>
</div>

<form method="post" id="courseForm">
    {% csrf_token %}
    
    <!-- Course Information -->
    <div class="section-card">
        <div class="section-header">
            <i class="fas fa-info-circle"></i> Course Information
        </div>
        <div class="section-body">
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="{{ form.name.id_for_label }}" class="form-label">Course Name *</label>
                        {{ form.name }}
                        {% if form.name.errors %}
                            <div class="text-danger">{{ form.name.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="{{ form.code.id_for_label }}" class="form-label">Course Code *</label>
                        {{ form.code }}
                        {% if form.code.errors %}
                            <div class="text-danger">{{ form.code.errors }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="{{ form.department.id_for_label }}" class="form-label">Department *</label>
                        {{ form.department }}
                        {% if form.department.errors %}
                            <div class="text-danger">{{ form.department.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="{{ form.duration_years.id_for_label }}" class="form-label">Duration (Years) *</label>
                        {{ form.duration_years }}
                        {% if form.duration_years.errors %}
                            <div class="text-danger">{{ form.duration_years.errors }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <div class="mb-3">
                <label for="{{ form.description.id_for_label }}" class="form-label">Description</label>
                {{ form.description }}
                {% if form.description.errors %}
                    <div class="text-danger">{{ form.description.errors }}</div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Subjects Section -->
    <div class="section-card">
        <div class="section-header">
            <i class="fas fa-book"></i> Subjects
        </div>
        <div class="section-body">
            <div id="subjects-container">
                <!-- Subject forms will be added here dynamically -->
            </div>
            <button type="button" class="btn btn-outline-primary add-btn" onclick="addSubject()">
                <i class="fas fa-plus"></i> Add Subject
            </button>
        </div>
    </div>

    <!-- Classes Section -->
    <div class="section-card">
        <div class="section-header">
            <i class="fas fa-users"></i> Classes
        </div>
        <div class="section-body">
            <div id="classes-container">
                <!-- Class forms will be added here dynamically -->
            </div>
            <button type="button" class="btn btn-outline-primary add-btn" onclick="addClass()">
                <i class="fas fa-plus"></i> Add Class
            </button>
        </div>
    </div>

    <!-- Student Enrollment Section -->
    <div class="section-card student-enrollment-section">
        <div class="section-header">
            <i class="fas fa-user-graduate"></i> Student Enrollment
            <small class="text-muted ms-2">(Optional - Add students to classes)</small>
        </div>
        <div class="section-body">
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i> 
                Students added here will be automatically enrolled in the selected class and will see the respective subjects in their dashboard.
            </div>
            <div id="students-container">
                <!-- Student enrollment forms will be added here dynamically -->
            </div>
            <button type="button" class="btn btn-outline-success add-btn" onclick="addStudent()">
                <i class="fas fa-user-plus"></i> Add Student
            </button>
        </div>
    </div>

    <!-- Submit Buttons -->
    <div class="row">
        <div class="col-12">
            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                <a href="{% url 'academic:course_list' %}" class="btn btn-secondary me-md-2">
                    <i class="fas fa-times"></i> Cancel
                </a>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Create Course
                </button>
            </div>
        </div>
    </div>
</form>
{% endblock %}

{% block extra_js %}
<script>
// Data from Django
window.academicYearsData = JSON.parse('{{ academic_years|escapejs }}');
window.teachersData = JSON.parse('{{ teachers|escapejs }}');
window.studentsData = JSON.parse('{{ students|escapejs }}');
</script>
<script src="{% static 'js/course-form-enhanced.js' %}"></script>
{% endblock %}