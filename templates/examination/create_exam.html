{% extends 'base.html' %}

{% block title %}Create Exam - SMS{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2><i class="fas fa-plus-circle"></i> Create New Exam</h2>
            <a href="{% url 'examination:exam_list' %}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Back to Exams
            </a>
        </div>
    </div>
</div>

<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h6 class="m-0"><i class="fas fa-clipboard-list"></i> Exam Details</h6>
            </div>
            <div class="card-body">
                <form method="post" id="examForm">
                    {% csrf_token %}
                    
                    {% if form.errors %}
                    <div class="alert alert-danger">
                        <strong>Please correct the following errors:</strong>
                        <ul class="mb-0">
                            {% for field in form %}
                                {% for error in field.errors %}
                                    <li>{{ field.label }}: {{ error }}</li>
                                {% endfor %}
                            {% endfor %}
                            {% for error in form.non_field_errors %}
                                <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                    
                    <!-- Basic Information -->
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.name.id_for_label }}" class="form-label">Exam Name *</label>
                            {{ form.name }}
                            {% if form.name.help_text %}
                            <small class="form-text text-muted">{{ form.name.help_text }}</small>
                            {% endif %}
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.exam_type.id_for_label }}" class="form-label">Exam Type *</label>
                            {{ form.exam_type }}
                            {% if form.exam_type.help_text %}
                            <small class="form-text text-muted">{{ form.exam_type.help_text }}</small>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.subject.id_for_label }}" class="form-label">Subject *</label>
                            {{ form.subject }}
                            {% if form.subject.help_text %}
                            <small class="form-text text-muted">{{ form.subject.help_text }}</small>
                            {% endif %}
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.class_for.id_for_label }}" class="form-label">Class *</label>
                            {{ form.class_for }}
                            {% if form.class_for.help_text %}
                            <small class="form-text text-muted">{{ form.class_for.help_text }}</small>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Date and Time -->
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="{{ form.exam_date.id_for_label }}" class="form-label">Exam Date *</label>
                            {{ form.exam_date }}
                            {% if form.exam_date.help_text %}
                            <small class="form-text text-muted">{{ form.exam_date.help_text }}</small>
                            {% endif %}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="{{ form.start_time.id_for_label }}" class="form-label">Start Time *</label>
                            {{ form.start_time }}
                            {% if form.start_time.help_text %}
                            <small class="form-text text-muted">{{ form.start_time.help_text }}</small>
                            {% endif %}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="{{ form.end_time.id_for_label }}" class="form-label">End Time *</label>
                            {{ form.end_time }}
                            {% if form.end_time.help_text %}
                            <small class="form-text text-muted">{{ form.end_time.help_text }}</small>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Marks -->
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.total_marks.id_for_label }}" class="form-label">Total Marks *</label>
                            {{ form.total_marks }}
                            {% if form.total_marks.help_text %}
                            <small class="form-text text-muted">{{ form.total_marks.help_text }}</small>
                            {% endif %}
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.passing_marks.id_for_label }}" class="form-label">Passing Marks *</label>
                            {{ form.passing_marks }}
                            <small class="form-text text-muted">Typically 40% of total marks</small>
                        </div>
                    </div>
                    
                    <!-- Instructions -->
                    <div class="mb-3">
                        <label for="{{ form.instructions.id_for_label }}" class="form-label">Instructions</label>
                        {{ form.instructions }}
                        {% if form.instructions.help_text %}
                        <small class="form-text text-muted">{{ form.instructions.help_text }}</small>
                        {% endif %}
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                        <a href="{% url 'examination:exam_list' %}" class="btn btn-outline-secondary me-md-2">
                            <i class="fas fa-times"></i> Cancel
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i> Create Exam
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
// Auto-calculate passing marks (40% of total marks)
document.getElementById('{{ form.total_marks.id_for_label }}').addEventListener('input', function() {
    const totalMarks = parseInt(this.value);
    if (totalMarks > 0) {
        const passingMarks = Math.ceil(totalMarks * 0.4);
        document.getElementById('{{ form.passing_marks.id_for_label }}').value = passingMarks;
    }
});

// Set minimum date to today
const examDateField = document.getElementById('{{ form.exam_date.id_for_label }}');
if (examDateField) {
    examDateField.min = new Date().toISOString().split('T')[0];
}

// Form validation
document.getElementById('examForm').addEventListener('submit', function(e) {
    const totalMarks = parseInt(document.getElementById('{{ form.total_marks.id_for_label }}').value);
    const passingMarks = parseInt(document.getElementById('{{ form.passing_marks.id_for_label }}').value);
    
    if (passingMarks >= totalMarks) {
        e.preventDefault();
        alert('Passing marks must be less than total marks');
        return false;
    }
    
    // Show loading state
    const submitBtn = document.querySelector('button[type="submit"]');
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating Exam...';
    submitBtn.disabled = true;
});
</script>
{% endblock %}