<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Student Management System{% endblock %}</title>

    {% load static %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>

{% if user.is_authenticated %}
<div class="layout-wrapper">

    <!-- ================= Mobile Menu Toggle ================= -->
    <button class="mobile-menu-toggle d-md-none" id="mobileMenuToggle" aria-label="Toggle Menu">
        <i class="fas fa-bars"></i>
    </button>

    <!-- ================= Desktop Sidebar Toggle ================= -->
    <button class="desktop-sidebar-toggle d-none d-md-flex" id="desktopSidebarToggle" aria-label="Toggle Sidebar">
        <i class="fas fa-bars"></i>
    </button>

    <!-- ================= Sidebar Overlay ================= -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- ================= Sidebar ================= -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-brand">
            <i class="fas fa-graduation-cap"></i>
            <span class="sidebar-text">SMS</span>
        </div>

        <ul class="sidebar-menu">
            <li>
                <a href="{% url 'accounts:dashboard' %}">
                    <i class="fas fa-tachometer-alt"></i> <span class="sidebar-text">Dashboard</span>
                </a>
            </li>

            {% if user.user_type == 'admin' %}
            <li>
                <a href="{% url 'accounts:admin_user_list' %}">
                    <i class="fas fa-users"></i> <span class="sidebar-text">User Management</span>
                </a>
            </li>
            <li>
                <a href="{% url 'academic:department_list' %}">
                    <i class="fas fa-book"></i> <span class="sidebar-text">Academic</span>
                </a>
            </li>
            {% endif %}

            {% if user.user_type == 'teacher' or user.user_type == 'admin' %}
            <li>
                <a href="{% url 'attendance:mark_attendance' %}">
                    <i class="fas fa-check-circle"></i> <span class="sidebar-text">Attendance</span>
                </a>
            </li>
            <li>
                <a href="{% url 'academic:assignment_list' %}">
                    <i class="fas fa-tasks"></i> <span class="sidebar-text">Assignments</span>
                </a>
            </li>
            <li>
                <a href="{% url 'examination:exam_list' %}">
                    <i class="fas fa-clipboard-list"></i> <span class="sidebar-text">Exams</span>
                </a>
            </li>
            {% endif %}

            {% if user.user_type == 'student' %}
            <li>
                <a href="{% url 'attendance:view_attendance' %}">
                    <i class="fas fa-calendar-check"></i> <span class="sidebar-text">Attendance</span>
                </a>
            </li>
            <li>
                <a href="{% url 'academic:student_assignments' %}">
                    <i class="fas fa-tasks"></i> <span class="sidebar-text">Assignments</span>
                </a>
            </li>
            <li>
                <a href="{% url 'examination:result_list' %}">
                    <i class="fas fa-chart-bar"></i> <span class="sidebar-text">Results</span>
                </a>
            </li>
            {% endif %}

            <li>
                <a href="{% url 'notifications:notification_list' %}">
                    <i class="fas fa-bell"></i> <span class="sidebar-text">Notifications</span>
                </a>
            </li>

            <li class="sidebar-divider"></li>

            <li>
                <a href="{% url 'accounts:profile' %}">
                    <i class="fas fa-user"></i> <span class="sidebar-text">Profile</span>
                </a>
            </li>
            <li>
                <a href="{% url 'accounts:logout' %}" class="logout">
                    <i class="fas fa-sign-out-alt"></i> <span class="sidebar-text">Logout</span>
                </a>
            </li>
        </ul>
    </aside>

    <!-- ================= Main Content ================= -->
    <main class="main-content" id="mainContent">
{% else %}
    <main class="container-fluid mt-4">
{% endif %}

        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        {% endif %}

        {% block content %}{% endblock %}

    </main>

{% if user.is_authenticated %}
</div>
{% endif %}

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- Sidebar Toggle Script (Mobile & Desktop) -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const mobileMenuToggle = document.getElementById('mobileMenuToggle');
    const desktopSidebarToggle = document.getElementById('desktopSidebarToggle');
    const sidebar = document.getElementById('sidebar');
    const sidebarOverlay = document.getElementById('sidebarOverlay');
    const mainContent = document.getElementById('mainContent');
    const layoutWrapper = document.querySelector('.layout-wrapper');
    
    // Check if sidebar was collapsed in previous session (desktop only)
    const sidebarCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
    if (sidebarCollapsed && window.innerWidth >= 768) {
        sidebar.classList.add('sidebar-collapsed');
        mainContent.classList.add('content-expanded');
        if (desktopSidebarToggle) {
            desktopSidebarToggle.classList.add('toggle-shifted');
        }
    }
    
    // Mobile sidebar functions
    function openMobileSidebar() {
        sidebar.classList.add('sidebar-open');
        sidebarOverlay.classList.add('active');
        mobileMenuToggle.classList.add('active');
        document.body.style.overflow = 'hidden';
        
        const icon = mobileMenuToggle.querySelector('i');
        icon.classList.remove('fa-bars');
        icon.classList.add('fa-times');
    }
    
    function closeMobileSidebar() {
        sidebar.classList.remove('sidebar-open');
        sidebarOverlay.classList.remove('active');
        mobileMenuToggle.classList.remove('active');
        document.body.style.overflow = '';
        
        const icon = mobileMenuToggle.querySelector('i');
        icon.classList.remove('fa-times');
        icon.classList.add('fa-bars');
    }
    
    // Desktop sidebar toggle function
    function toggleDesktopSidebar() {
        sidebar.classList.toggle('sidebar-collapsed');
        mainContent.classList.toggle('content-expanded');
        desktopSidebarToggle.classList.toggle('toggle-shifted');
        
        // Save state to localStorage
        const isCollapsed = sidebar.classList.contains('sidebar-collapsed');
        localStorage.setItem('sidebarCollapsed', isCollapsed);
        
        // Update toggle button icon
        const icon = desktopSidebarToggle.querySelector('i');
        if (isCollapsed) {
            icon.classList.remove('fa-bars');
            icon.classList.add('fa-chevron-right');
        } else {
            icon.classList.remove('fa-chevron-right');
            icon.classList.add('fa-bars');
        }
    }
    
    // Mobile menu toggle
    if (mobileMenuToggle && sidebar) {
        mobileMenuToggle.addEventListener('click', function() {
            if (sidebar.classList.contains('sidebar-open')) {
                closeMobileSidebar();
            } else {
                openMobileSidebar();
            }
        });
        
        // Close sidebar when clicking overlay
        if (sidebarOverlay) {
            sidebarOverlay.addEventListener('click', closeMobileSidebar);
        }
        
        // Close sidebar when clicking a link on mobile
        const sidebarLinks = sidebar.querySelectorAll('a');
        sidebarLinks.forEach(link => {
            link.addEventListener('click', function() {
                if (window.innerWidth <= 767) {
                    closeMobileSidebar();
                }
            });
        });
    }
    
    // Desktop sidebar toggle
    if (desktopSidebarToggle) {
        desktopSidebarToggle.addEventListener('click', toggleDesktopSidebar);
        
        // Update icon on page load if collapsed
        if (sidebarCollapsed) {
            const icon = desktopSidebarToggle.querySelector('i');
            icon.classList.remove('fa-bars');
            icon.classList.add('fa-chevron-right');
        }
    }
    
    // Handle window resize
    window.addEventListener('resize', function() {
        if (window.innerWidth > 767) {
            closeMobileSidebar();
        }
        
        // Remove desktop collapsed state on mobile
        if (window.innerWidth <= 767) {
            sidebar.classList.remove('sidebar-collapsed');
            mainContent.classList.remove('content-expanded');
            if (desktopSidebarToggle) {
                desktopSidebarToggle.classList.remove('toggle-shifted');
            }
        }
    });
});
</script>

{% block extra_js %}{% endblock %}
</body>
</html>
